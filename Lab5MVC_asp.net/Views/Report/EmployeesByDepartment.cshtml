@model Lab5MVC_asp.net.Models.ReportViewModel
@{
    ViewBag.Title = "Отчет: Сотрудники с проектами по отделам";
}

<h2>@ViewBag.Title</h2>

@using (Html.BeginForm("EmployeesByDepartment", "Report", FormMethod.Post))
{
    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        <h4>Выберите отдел для формирования отчета</h4>
        <hr />

        @Html.ValidationSummary(true, "", new { @class = "text-danger" })

        <div class="form-group">
            @Html.LabelFor(model => model.SelectedDepartmentId, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.DropDownListFor(model => model.SelectedDepartmentId,
                         new SelectList(Model.Departments, "ID", "DepartmentName"),
                         "-- Выберите отдел --",
                         new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.SelectedDepartmentId, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="Сформировать отчет" class="btn btn-primary" />
                @Html.ActionLink("Отмена", "Index", "Home", null, new { @class = "btn btn-default" })
            </div>
        </div>
    </div>
}

@if (Model.Results != null && Model.Results.Any())
{
    <hr />

    <h3>Результаты отчета</h3>
    <p>
        Отдел: <strong>@Model.Departments.FirstOrDefault(d => d.ID == Model.SelectedDepartmentId)?.DepartmentName</strong>
    </p>
    <p>Найдено записей: <strong>@Model.Results.Count</strong></p>

    <table class="table table-bordered table-striped">
        <thead class="thead-dark">
            <tr>
                <th>ID сотрудника</th>
                <th>ФИО</th>
                <th>Отдел</th>
                <th>Специальность</th>
                <th>Код проекта</th>
                <th>Статус участия</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.Results)
            {
                <tr>
                    <td>@item.EmployeeId</td>
                    <td>@item.FullName</td>
                    <td>@item.DepartmentName</td>
                    <td>@item.SpecialtyName</td>
                    <td>@item.ProjectCode</td>
                    <td>@item.ParticipationStatus</td>
                </tr>
            }
        </tbody>
    </table>
}
else if (Model.SelectedDepartmentId > 0 && (Model.Results == null || !Model.Results.Any()))
{
    <div class="alert alert-info mt-3">
        <strong>Информация:</strong> В выбранном отделе нет сотрудников с проектами.
    </div>
}

<div class="mt-3">
    @Html.ActionLink("Назад к списку отчетов", "Index", "Report", null, new { @class = "btn btn-link" })
</div>